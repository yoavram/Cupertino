\documentclass[9pt, a4paper, twocolumn]{extarticle}
\usepackage[margin=1in]{geometry} % See geometry.pdf to learn the layout options.
\geometry{a4paper}
%\usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx} % Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
% TeX will automatically convert eps --> pdf in pdflatex		

\usepackage{amssymb,amsmath,amsthm}
\usepackage{commath}
\usepackage{longtable}
\usepackage[hyphens]{url}
\PassOptionsToPackage{hyphens}{url} % url is loaded by hyperref
\usepackage[unicode=true]{hyperref}
%\usepackage{nameref} % included in hyperref
\usepackage[auth-sc]{authblk}

% messes up nameref
%\usepackage{titlesec}
%\titleformat{\subsection}[runin]
%  {\bf}{\thesection}{1em}{}
  
%SetFonts
% newtxtext+newtxmath
\usepackage{newtxtext} %loads helv for ss, txtt for tt
\usepackage{amsmath}
\usepackage[bigdelims]{newtxmath}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
%SetFonts

% Yoav & Lee commands
\newcommand*{\tr}{^\intercal}
\let\vec\mathbf
\newcommand{\matrx}[1]{{\left[ \stackrel{}{#1}\right]}}
\newcommand{\diag}[1]{\mbox{diag}\matrx{#1}}
\newcommand{\goesto}{\rightarrow}
\newcommand{\dspfrac}[2]{\frac{\displaystyle #1}{\displaystyle #2} }
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\newtheorem{lemma}{Lemma}
\newtheorem{remark}{Remark}
%\newtheorem*{mfp}{Theorem: Mean Fitness Principle}
%\newtheorem*{rvp}{Corollary: Reproductive Value Principle}
%\newtheorem*{frv}{Fisher's reproductive values}
\renewcommand\qedsymbol{} % no square at end of proof
\newcommand{\cl}{\mathbf{L}}
\newcommand{\cj}{\mathbf{J}}
\newcommand{\ci}{\mathbf{I}}


% NatBib
\usepackage[round,colon,authoryear]{natbib}

% Title page
\title{Variation generation and mean fitness increase: \\ Necessity is the mother of genetic invention}

\author[a]{Yoav Ram}
\author[b]{Lee Altenberg}
\author[a]{Marcus W. Feldman}
\affil[a]{Department of Biology, Stanford University, Stanford, CA}
\affil[b]{Information and Computer Sciences, University of Hawai`i at M{\=a}noa, Honolulu, HI}

\date{\today}

% Document
\begin{document}
\maketitle

% Abstract
\begin{abstract}
Generation of variation may be detrimental in well-adapted populations evolving under constant selection.
In a constant environment, genetic modifiers that reduce the rate at which variation is generated by processes such as mutation and migration, succeed.
However, departures from this \emph{reduction principle} have been demonstrated.
Here we analyze a general model of evolution under constant selection where the rate at which variation is generated can depend on the fitness of the individual.
We find that if a modifier allele increases the rate at which individuals of below-average fitness generate variation, then it will increase in frequency and increase the  population mean fitness.
This principle applies to phenomena such as stress-induced mutagenesis, condition-dependent dispersal and outcrossing,
and demonstrates the proverb: \emph{"Necessity is the mother of genetic invention"}.
\end{abstract}

% Introduction
\section*{Introduction}

According to the \emph{reduction principle}, in populations that evolve near an equilibrium between natural selection and a process that generates variation (i.e. mutation, migration, or recombination), selection favors neutral modifiers that decrease the rate at which variation is generated. 

The \emph{reduction principle} was demonstrated for modifiers of the recombination~\citep{Feldman1972}, mutation, and migration~\citep{Liberman1986a}, and dispersal rates~\citep{Altenberg1987}.
These separate principles were recently unified by~\citet{Altenberg2017}

The assumptions and conditions for the validity of the \emph{unified reduction principle} by neutral genetic modifiers are~\citep{Altenberg2017}:
(i) effectively infinite population size, (ii) constant-viability selection, (iii) a population at an equilibrium, and (iv) \emph{linear variation} -- the equal scaling of transition probabilities by the modifier.
A departure from the latter assumption occurs if two variation-producing processes interact~\citep{Feldman1980,Altenberg2012}.
Departures from the \emph{reduction principle} have also been demonstrated when conditions (i)-(iii) are not met, see for example~\citet{Holsinger1986} and references therein.

Another departure from the \emph{linear variation} assumption of the \emph{reduction principle} for mutation rates involves \emph{stress-induced mutagenesis}, a mechanism in which the mutation rate increases in individuals with poor fitness.
Empirical evidence suggests \emph{stress-induced mutagenesis} is common in bacteria and yeast, and may be prevalent in plants, flies, and human cancer cells~\citep{Rosenberg2012,Fitzgerald2017b}.
\citet{Ram2012} demonstrated that modifiers that increase the mutation rate of individuals with below-average fitness actually \textbf{increase} the population mean fitness, rather than decrease it.
Their analysis assumed an infinite population size and constant-viability selection, where the only departure from the \emph{reduction principle} assumptions is due to the differential effect the modifier has on different genotypes.
A similar result has been demonstrated for fitness-associated recombination~\citep{Hadany2003a} and for condition-dependent sexual reproduction~\citep{Hadany2007a}, and evidence suggests that both mechanisms are common in nature~\citep{Ram2016}.

\citet{Ram2012} stated that their result represents a departure from the \emph{reduction principle}, but did not explain this departure.
Their analysis was specific to a model that classified individuals by the number of mutant genes in their genotype, similar to models studied by~\citet{Kimura1966a} and~\citet{Haigh1978}.
Moreover, their argument was based on expected increase of the population mean fitness by alleles that modify the mutation rate, rather than on the invasion success of such modifiers~\citep[i.e., analysis of \emph{evolutionary genetic stability}, see][]{Eshel1982, Lessard1990}.

Here, we present a general evolutionary model where the rate at which variation is generated depends on the type of the individual, and specifically on its fitness.
Our results show that the population mean fitness increases if below-average individuals produce more variation than above-average individuals,
and that modifier alleles that induce below-average to produce more variation are favored by natural selection.

% Model
\section*{Models}

\paragraph*{General model.}\label{sec:general_model}
Consider a large haploid population with an arbitrary set of types $A_1, A_2, \ldots, A_n$.
The change in the frequencies of these types is described by the transformation $f \to f'$: 
\begin{equation}\label{eq:model}
\bar{w} f' = (I-C+MC)D f,
\end{equation}
where $f_k$ is the frequency of type $A_k$: $f=(f_1, f_2, \ldots, f_n)$ is a stochastic vector such that $\sum_{k=1}^n{f_k} = 1$;
$C_k$ is the probability that an individual of type $A_k$ will transition to another type ($C$ is a diagonal non-negative matrix with diagonal elements $C_k$);
$M_{i,j}$ is the transition probability from type $A_j$ to type $A_i$ given that an individual of type $A_j$ is transitioning ($M$ is a column-stochastic matrix: $M_{i,j} \ge 0$ for all $i,j$ and $\sum_{j=1}^n {M_{i,j}} = 1$ for all $j$); 
$D_k$ is the relative fitness of type $A_k$ ($D$ is a diagonal matrix with diagonal elements $D_k$, where we can assume $0 < D_k \le 1$, i.e., fitness values are relative to the fitness of the fittest type); 
$I$ is the identity matrix;
and $\bar{w}$ is the normalizing factor such that $\sum_{k=1}^n{f'_k}=1$ and is equal to the population mean fitness (see~\nameref{sec:AppA}).

The types $A_k$ can represent a single or multiple haploid genetic loci or non-genetic traits.
Importantly, type transmission is vertical and uni-parental (the type is transmitted from a single parent to the offspring) and is independent of the frequencies of the other types.
Specifically, this model precludes processes such as recombination, social learning, sexual outcrossing, and any horizontal or oblique transmission, as these processes are frequency-dependent~\cite[pg.~54]{Cavalli-Sforza1981}.

Transition between types is determined by a combination of two effects:
(i) the probability to transition \emph{out} of type $A_k$ is determined by $C_k$;
(ii) given a transition out of type $A_k$, the distribution of the destination types $A_j$ is given by $M_{j,k}$ (note the index order).
Importantly, different types can have different rates; that is, $C_j \ne C_i$ for some $i,j$. The case $C_j = C_j$ for all $i,j$ is covered by the \emph{reduction principle}~\citep[see][]{Altenberg2017}.

In the following section we present three examples of the model presented in Eq.~\ref{eq:model} for mutation and migration.

% Mutation model 1
\paragraph*{Mutation model 1.}\label{sec:mut_model_1}

Here we consider a large population of haploids and a trait determined by a major locus with $n$ possible alleles $A_1, A_2, ..., A_n$.
The mutation rates $\mu_k$ of individuals with allele $A_k$ are potentially different;
specifically, with probability $1-\mu_k$, the allele $A_k$ does not mutate, and with probability $\frac{\mu_k}{n-1}$, the allele $A_k$ mutates to $A_j$ for any $j \ne k$.
This is an extension of a model studied by~\citet{Altenberg2017} that allows for the mutation rate of an individual, $\mu_k$, to depend on the identity of the allele $A_k$.

Let the frequency of $A_k$ in the present generation be $f_k$ with $f_k \ge 0$ and $\sum_k{f_k}=1$.
Then after selection and mutation, $f'_k$ in the next generation is given by
\begin{equation}
f_k' = (1 - \mu_k) \frac{w_k}{\bar{w}} f_k + \frac{1}{n-1} \sum_{k \ne j}{\mu_j \frac{w_j}{\bar{w}} f_j},
\label{eq:mutation_model_1}
\end{equation}
for all $k=1,2,\ldots,n$, where $\bar{w} = \sum_{k=1}^{n}{w_k f_k}$ is the population mean fitness.

This model can be rephrased in terms of the general model: 
Eq.~\ref{eq:mutation_model_1} is equivalent to Eq.~\ref{eq:model} if we set
\begin{equation} 
C_k = \mu_k, \quad
D_k = w_k, \quad
M_{i,j} = \begin{cases}
\frac{1}{n-1}, & i \ne j \\
0, & i=j
\end{cases}.
\end{equation}

% Mutation model 2
\paragraph*{Mutation model 2.}\label{sec:mut_model_2}

Here, we consider a large population of haploids in which individuals with genotype $A_k$ are characterized by the number $k$ of deleterious or mutant alleles in their genotype, where $0 \le k \le n$.
Importantly, the probability $m_k$ that a mutation occurs in individuals with $k$ mutant alleles depends on $k$.
We assume a low mutation rate $m_k$ so that two mutations are unlikely to occur in the same individual in one generation.
When a mutation occurs it is \emph{deleterious} with probability $\delta$, generating a mutant allele and converting the individual from $A_k$ to $A_{k+1}$, or it is beneficial with probability $\beta$, converting the individual from $A_k$ to $A_{k-1}$.
Note that such beneficial mutations can be either compensatory or back-mutations, and that mutations are neutral with probability $1-\delta-\beta$.
This model has been analyzed by~\citet{Ram2012}.

Let the frequency of $A_k$ in the present generation be $f_k$ such that $f_k \ge 0$ and $\sum_{k=0}^{n}{f_k}=1$.
Then after selection and mutation $f'$ in the next generation is given by
\begin{equation}
\begin{aligned}
f_0' &= (1 - \delta m_0) \frac{w_0}{\bar{w}} f_0 + \beta m_{1} \frac{w_{1}}{\bar{w}} f_{1}, \\
f_n' &= (1 - \beta m_n) \frac{w_n}{\bar{w}} f_n + \delta m_{n-1} \frac{w_{n-1}}{\bar{w}} f_{n-1}, \\
f_k' &= (1 - m_k(\delta+\beta)) \frac{w_k}{\bar{w}} f_k + \\
	 & \delta m_{k-1} \frac{w_{k-1}}{\bar{w}} f_{k-1} + 
	 \beta m_{k+1} \frac{w_{k+1}}{\bar{w}} f_{k+1},
\end{aligned}
\label{eq:mutation_model_2}
\end{equation}
for $k=1,2,\ldots, n-1$, where $w_k$ is the fitness of an individual with $k$ mutant alleles and $\bar{w} = \sum_{k=0}^{n}{w_k f_k}$ is the population mean fitness.

In terms of the general model, we can write
\begin{equation}
C_k = m_k, \quad
D_k = w_k,
%M_{i,j} = \begin{cases}
%\beta, & i = j-1 \\
%1-\beta-\delta, & i = j \\
%\delta, & i = j+1 \\
%1-\delta, & i=j=0 \\
%0, & \text{otherwise}
%\end{cases}
\end{equation}
and
\begin{equation}
M_{i,j} = \begin{bmatrix}
1-\delta & \beta & 0 &  \cdots \\
\delta & 1-\delta-\beta & \beta &  \ddots \\
0 & \delta & 1-\delta-\beta & \ddots \\
\vdots & \ddots & \ddots & \ddots 
\end{bmatrix},
\end{equation}
in which case Eq.~\ref{eq:mutation_model_2} is a specific case of Eq.~\ref{eq:model}.

% Migration model
\paragraph*{Migration model.}\label{sec:mig_model_1}

Here we assume a large population of haploids that occupies two demes.
Let the fitness of genotypes $A_k$ be $w_k$ in deme 1 and $q_k$ in deme 2 for $k=1,2,\ldots,n$.
The probability that an individual with genotype $A_k$ migrates between the deme is $m_k$; that is, migration rates depend on the genotypes.
Let the frequencies of $A_k$ be $x_k$ in deme 1 and $y_k$ in deme 2 for $k=1,2,\ldots,n$ with $x_k \ge 0$, $y_k \ge 0$, $\sum_{k=1}^{n}{x_k} = 1$, and $\sum_{k=1}^{n}{y_k} = 1$.

Following selection and migration the new frequencies $x_k'$ and $y_k'$ are given by
\begin{align}
x_k' = (1-m_k) \frac{w_k}{\bar{w}} x_k + m_k \frac{q_k}{\bar{q}} y_k \\
y_k' = m_k \frac{w_k}{\bar{w}} x_k + (1 - m_k) \frac{q_k}{\bar{q}} y_k
\end{align}
for $k=1,2,\ldots,n$, where $\bar{w} = \sum_{k \ge 0}{w_k x_k}$ and $\bar{q} = \sum_{k \ge 0}{q_k y_k}$ are the population mean fitnesses in deme 1 and 2, respectively.
This is an extension of a model presented by~\citet{Altenberg2017}.

To rephrase this model in terms of the general model, we define
\begin{equation}
\begin{aligned}
f = (x_1, \ldots, x_n, y_1, \ldots, y_n)\tr, \\
C = diag[m_1, \ldots, m_n, m_1, \ldots, m_n], \\
D = diag[w_1, \ldots, w_n, q_1, \ldots, q_n], \\
M = \begin{bmatrix}
0 & I_n \\
I_n & 0
\end{bmatrix}
\end{aligned}
\end{equation}
where $I_n$ is the n-by-n identity matrix.

% Results
\section*{Results}

\subsection*{Mean fitness principle}

We first focus on the stable population mean fitness.
We will show that if the transition rate from types with below-average fitness increases, then the stable population mean fitness increases, too.

% Mean fitness principle

Write the equilibrium of the frequency vector $f$ in Eq.~\ref{eq:model} as $v$ and the stable population mean fitness as $\bar{w}^*$, then
\begin{equation}\label{eq:model_equilibrium}
\bar{w}^* v = (I-C+MC)D v.
\end{equation}
Note that (i) the existence of $\bar{w}^*$ and $v$ are guaranteed by the \emph{Perron-Frobenius theorem}~\cite[Appendix~A]{Otto2007} because $(I-C+MC)D$ is a non-negative matrix; 
(ii) the local stability of this equilibrium is proven in~\nameref{sec:AppD}; and
(iii) $\bar{w}^*$ is identified as the stable population mean fitness in~\nameref{sec:AppA}.

The following lemma presents a \emph{mean fitness principle} for the
sensitivity of the stable population mean fitness $\bar{w}^*$ to changes
in $C_k$, the probability of transition from $A_k$.

\begin{lemma}[Mean fitness principle]\label{lemma:mfp}
Let $\bar{w}^*$ be the leading eigenvalue of $(I-C+MC)D$, $u$ and $v$ be the corresponding left and right eigenvectors, and $[M]_k$ the $k$-th column of $M$. Then
\begin{equation}\label{mfp}
\frac{\partial \bar{w}^*}{\partial C_k} = 
\frac{u_k v_k}{C_k} (\bar{w}^* - D_k),
\end{equation}
or in simpler terms,
\begin{equation}\label{mfp_sign}
sign\frac{\partial \bar{w}^*}{\partial C_k} = 
sign(\bar{w}^* - D_k).
\end{equation}

Therefore increased transition from type $k$ will increase the stable population mean fitness if the fitness of type $k$ is below the stable population mean fitness.
\end{lemma}

\begin{proof}
$\bar{w}^*$ is the leading (real positive) eigenvalue of $(I-C+MC)D$ (see eq.~\ref{eq:model_equilibrium}),
and the corresponding left and right eigenvectors $u$ and $v$ are both non-negative and uniquely defined by $\sum_k{v_k} = 1$ and $\sum_k{u_k v_k} = 1$.

Using \emph{Caswell's formula} (Eq.~\ref{eq:Caswells_formula} in~\nameref{sec:AppB}),
\begin{equation}
\frac{\partial \bar{w}^*}{\partial C_k} = 
u\tr \frac{\partial (I-C+MC)D}{\partial C_k} v.
\end{equation}

Let $e_k$ and $e\tr_k$ be the column and row vectors with 1 at position $k$ and 0 elsewhere, $Z_k = e_k e\tr_k$ the matrix with 1 at position $(k,k)$ and 0 elsewhere, and $[M]_k$ the $k$-th column of $M$.

Then,
\begin{equation}\label{mfp_intermediate}
\begin{aligned}
u\tr \frac{\partial (I-C+MC)D}{\partial C_k} v = 
u\tr (0 - Z_k + M Z_k)D v = \\
-v_k u_k D_k + v_k D_k u\tr[M]_k = \\
v_k D_k (u\tr[M]_k - u_k). 
\end{aligned}
\end{equation}

The corresponding equation to Eq.~\ref{eq:model_equilibrium} for the left
eigenvector $u$ is 
\begin{equation}
u\tr \bar{w}^* = u\tr (I - C + MC) D,
\end{equation}
which gives us a relation between $\bar{w}^*$ and the $k$
element of $u$:
\begin{equation}
u_k \bar{w}^* = (1-C_k) D_k u_k + C_k D_k u\tr [M]_k.
\end{equation}
Multiplying both sides by $v_k$ (which is positive if $D_k>0$) and rearranging, we get 
\begin{equation}
\frac{u_k v_k}{C_k} (\bar{w}^* - D_k) = v_k D_k(u\tr [M]_k - u_k),
\end{equation}
which when substituted into Eq.~\ref{mfp_intermediate} yields:
\begin{equation}
\frac{\partial \bar{w}^*}{\partial C_k} = 
\frac{u_k v_k}{C_k} (\bar{w}^* - D_k).
\end{equation}
Finally, note that $u_k, v_k, C_k \ge 0$ and therefore
\begin{equation}
sign \frac{\partial \bar{w}^*}{\partial C_k} = 
sign (\bar{w}^* - D_k),
\end{equation}
which completes the proof.
\end{proof}

The above lemma provides a condition for the effect of changing $C_k$, the probability for transition from $A_k$, on the stable population mean fitness.
Specifically, if $A_k$ individuals have below-average fitness, then increasing $C_k$ will increase the population mean fitness.

% Reproductive value principle

An interesting intermediate result in Eq.~\ref{mfp_intermediate} is

\begin{equation}
\begin{aligned}
\frac{\partial \bar{w}^*}{\partial C_k} = 
v_k D_k (u\tr[M]_k - u_k) = \\
D_k (\sum_i{u_i M_{i,k} v_k} - u_k v_k).
\end{aligned}
\end{equation}
Here, $u_k$ can be regarded as the \emph{reproductive value}~\citep[pg.~27]{Fisher1930} of type $k$ (see~\nameref{sec:AppC}), which gives the relative contribution of type $k$ to the long-term population.
Consequently, $u_k v_k$ is the \emph{ancestor frequency} of type $k$~\citep{Hermisson2002}, namely the fraction of the equilibrium population descended from type $k$.
The sum $\sum_i{u_i M_{i,k} v_k}$ can be similarly interpreted as the fraction of the equilibrium population descended from individuals that transitioned from type $k$ to another type (via the $k$ column of the transition matrix $M$), conditioned on transition occuring.

Given $0 < D_k \le 1$, from Eq.~\ref{mfp_intermediate} we have the following corollary.

\begin{corollary}[Reproductive value principle]
In the notation of Lemma~\ref{lemma:mfp},
\begin{equation}
sign \frac{\partial \bar{w}^*}{\partial C_k} = 
sign (u\tr [M]_k - u_k);
\end{equation}
therefore, increased transition from type $k$ will increase the stable population mean fitness if the fraction of the population descended from type $k$ is expected to increase due to a transition to another type. 
\end{corollary}

% Threshold rule

We turn our attention to the case where the transition occurs from a subset $K$ of the types.
For example, \citet[Appendix~B]{Ram2012} considered individuals that are grouped by the number of their accumulated deleterious mutations, $k$, 
and a modifier allele that regulates the mutation rates in individuals with at least $\pi$ deleterious mutations.
Similarly, if the transition rates are controlled by a threshold rule 
\begin{equation}
C_k = \begin{cases}
\tau, & k \in K \\
1, & k \not\in K
\end{cases}.
\end{equation}
If $\tau > 0$, then the sensitivity of the stable population mean fitness to changes in the
rate of transition from types in $K$ can be written 
\begin{equation}
\begin{aligned}
\frac{\partial \bar{w}^*}{\partial \tau} = 
u\tr \Big( \sum_{k \in K}{\frac{\partial (I - C + MC)D}{\partial \tau}} \Big) v = \\
\frac{1}{\tau} \sum_{k \in K}{u_k v_k (\bar{w}^* - D_k)}.
\end{aligned}
\end{equation}
Thus
\begin{multline}\label{mfp_sign_threshold}
sign \frac{\partial \bar{w}^*}{\partial \tau} = 
sign \sum_{k \in K}{u_k v_k (\bar{w}^* - D_k)} = \\ 
sign \Big(\bar{w}^* - \frac{\sum_{k \in K}{u_k v_k D_k}}{\sum_{k \in K}{u_k v_k}}\Big), 
\end{multline}
a generalization of Eq.~\ref{mfp_sign}.
Therefore, increased transition from types in $K$ will increase the stable population mean fitness if the average fitness of individuals descended from types in $K$ is below the stable population mean fitness.

\subsection*{Evolutionary genetic stability}

% Modifier model
We now focus on a neutral modifier locus in complete linkage to the types $A_k$, with no direct effect on fitness, and whose sole function is to determine $C_k$, the rates of transition from the different types.
We will show that modifier alleles that increase the stable population mean fitness in accordance with Lemma~\ref{lemma:mfp} are favored by natural selection.

\paragraph*{Modifier model.}
Consider the case of two modifier alleles, $m$ and $M$, inducing different transition probabilities $C=\diag{C_1, \ldots, C_n}$ and $\tilde{C}=\diag{\tilde{C}_1, \ldots, \tilde{C}_n}$, respectively.
The frequencies of type $A_k$ linked to modifier $m$ or $M$ are $f_k$ and $g_k$, respectively, such that $\sum_{k=1}^{n}{(f_k + g_k)}=1$.
$\bar{w}$ now ensures that $\sum_{k=1}^{n}{(f_k' + g_k')}=1$, 
and the rest of the model parameters are the same as in Eq.~\ref{eq:model}.

The frequencies in the next generation, $f'$ for allele $m$ and $g'$ for allele $M$, are given by
\begin{equation}
\begin{cases}
\bar{w} f' &= (I-C+MC)D f \\
\bar{w} g' &= (I-\tilde{C}+M\tilde{C})D g
\end{cases}.
\label{eq:modifier_model}
\end{equation}
Here, $\bar{w}=\sum_{k=1}^{n}{(f_k+g_k)D_k}$ is the mean fitness of the entire population (see~\nameref{sec:AppA}). 
Note that Eq.~\ref{eq:model} is the special case of Eq.~\ref{eq:modifier_model} where allele $M$ is absent; i.e. $g_k=0$ for all $k$.

% Evolutionary stability

We have found a condition for a modifier allele that controls that transition rate $C_k$ from type $A_k$ to increase the stable population mean fitness (Lemma~\ref{lemma:mfp}).
Could such an allele increase in frequency when initially rare in the population?
To answer this we analyze the stability of resident modifier allele $m$ with transition rates $C_k$ to the invasion by a modifier allele $M$ with rates $\tilde{C}_k$, see Eq.~\ref{eq:modifier_model}~\citep[for an introduction to \emph{evolutionary invasion analysis}, see][ch.~12]{Otto2007}

The equilibrium of Eqs.~\ref{eq:modifier_model} when modifier allele $M$ is absent from the population is $(v, 0)$, where $v$ is given in Eq.~\ref{eq:model_equilibrium} and $g_k=0$ for all $k$. 
The stability of allele $m$ to invasion by allele $M$ is determined by the leading eigenvalue $\lambda_1$ of $\cl_{ex}$ the external stability matrix of the equilibrium $(v,0)$, which, in turn, is determined by the Jacobian $\cj$ of the system in Eq.~\ref{eq:modifier_model} evaluated at the equilibrium $(v,0)$, where
\begin{equation}
\cj = \begin{pmatrix}\cl_{in} & 0 \\ 0 & \cl_{ex} \end{pmatrix},
\end{equation}
and $\cl_{in}$ is the local stability matrix of the equilibrium $(v,0)$ in the space $\sum_{k=1}^n{v_k}=1$.
The zero block matrices are due to the complete linkage between the modifier and the types $A_k$ and to the lack of transition (i.e., mutation) between the modifier alleles.

$\cl_{ex}$ can be written as
\begin{equation}\label{eq:Lex}
\cl_{ex} = (I - \tilde{C} + M \tilde{C}) D /\bar{w}^*,
\end{equation}
where $\bar{w}^*$ is the stable population mean fitness in the absence of modifier allele $M$ (see~\nameref{sec:AppA}).
Note that, in general, $\bar{w}^*$ is not an eigenvalue of $\cl_{ex}$.

\begin{theorem}[Evolution of increased genetic variation]
Let $\lambda_1$ be the the leading eigenvalue of the external stability matrix $\cl_{ex}$.
If the transition rates induced by the modifier alleles $m$ and $M$ are equal, i.e., $\tilde{C}_k=C_k$ for all $k$, then the following applies
\begin{equation}
\lambda_1=1,
\end{equation}
and
\begin{equation}
sign \frac{\partial \lambda_1}{\partial \tilde{C}_k}\bigg\rvert_{\tilde{C}_k = C_k} = 
sign(\bar{w}^* - D_k).
\end{equation}

Therefore, an initially rare modifier allele $M$ with transition rates slightly different from the resident allele $m$ can successfully invade the population ($\lambda_1>1$) if $M$ increases the probability of transition from types with below-average fitness, thereby increasing the stable population mean fitness.
\end{theorem}

\begin{proof}
Substituting $\tilde{C}=C$ in Eq.~\ref{eq:Lex} and multiplying both sides by $\bar{w}^*$,
\begin{equation}
\bar{w}^* \cl_{ex}\big\rvert_{\tilde{C}_k = C_k} = (I-C+MC) D,
\end{equation}
and since $\bar{w}^*$ is the leading eigenvalue of the RHS (see Eq.~\ref{eq:model_equilibrium} and \nameref{sec:AppA}),
the leading eigenvalue of $\cl_{ex}\big\rvert_{\tilde{C}_k = C_k}$ is $\lambda_1=1$.

Now, applying Lemma~\ref{lemma:mfp} (eq.~\ref{mfp_sign}) to Eq.~\ref{eq:Lex}, the sign of the derivative of $\lambda_1$ with respect to $\tilde{C_k}$ is
\begin{equation}
sign \frac{\partial \lambda_1}{\partial \tilde{C}_k} =
sign\Big(\lambda_1 - \frac{D_k}{\bar{w}^*}\Big).
\end{equation}
Evaluating this expression at $\tilde{C}_k = C_k$, i.e. at $\lambda_1=1$, gives us
\begin{multline}
sign \frac{\partial \lambda_1}{\partial \tilde{C}_k}\bigg\rvert_{\tilde{C}_k = C_k} = 
sign\Big(1 - \frac{D_k}{\bar{w}^*}\Big) =  
sign(\bar{w}^* - D_k),
\end{multline}
since $\bar{w}^*>0$.
This completes the proof.
\end{proof}

Note that if the modifier has the same effect on all individuals (i.e., $C_k = \alpha$ and $\tilde{C}_k = \alpha^*$ for all $k$) then $\cl_{ex}$ becomes
\begin{equation}
\cl_{ex} = ((1 - \alpha^*)I + \alpha^* M) D /\bar{w}^*,
\end{equation}  
and the \emph{unified reduction principle} is in effect~\cite[eqs. 65, 72]{Altenberg2017}.
Therefore, we can expect that with these modifiers, an allele $M$ that reduces the transition rate, i.e. $\alpha^* < \alpha$, will be favored by natural selection.
Indeed, setting $C = \alpha I$ in Eq.~\ref{eq:model_equilibrium} and proceeding as in the above, we find
$$
\frac{\partial \bar{w}^*}{\partial \alpha} = 
\bar{w}^* - 1 \le 0,
$$
because $\bar{w}^* = \sum_{k=1}^{n}{v_k D_k}$ (see~\nameref{sec:AppA}), and $D_k \le 1$ for all $k$.


% Discussion
\section*{Discussion}

We have shown that under constant-viability selection and in an effectively infinite haploid population at mutation-selection or migration-selection equilibrium, the stable population mean fitness increases if individuals with below-average fitness increase the rate at which variation is generated. Furthermore, modifier alleles that induce increased generation of variation in such individuals are favored by natural evolution.

We have given several examples of variation-generating processes for which this principle applies -- namely mutation and migration -- but our model may apply to other processes as well.
For example, the \emph{reduction principle} applies to ecological models of dispersal, and~\citet{Gueijman2013} have demonstrated that even in homogeneous environments, fitness-associated dispersal increases the population mean fitness and is favored by selection over uniform dispersal.
Similarly, if the transmission fidelity of culturally-transmitted traits depends on the type of the type or fitness of the transmitting individual, we expect that our results will hold.

Eq.~\ref{mfp} is a generalization of a result of~\citet[Eq.~4]{Ram2012}.
\citeauthor{Ram2012} modeled the accumulation of mutant alleles in a population evolving at the mutation-selection balance (see \nameref{sec:mut_model_2}).
Using Eq.~\ref{eq:Caswells_formula} in \nameref{sec:AppB} and a recursion on the ratios of the reproductive values \cite[see][eqs.~A5-6]{Ram2012}, they concluded that at the mutation-selection balance, if individuals with below-average fitness ($D_k < \bar{w}^*$) increase their mutation rate, then the population mean fitness will increase -- a result generalized by our \emph{mean fitness principle} in Eqs.~\ref{mfp_sign} and~\ref{mfp_sign_threshold}.

Our analysis focuses on populations at equilibrium.
Nevertheless, it has been demonstrated that a modifier which increases the mutation rate of maladapted individuals can be favored by selection~\citep{Ram2012} and reduce the adaptation rate~\citep{Ram2014}.
Similar results have been demonstrated for a modifier that increases the recombination rate in maladapted individuals~\citep{Hadany2003a,Hadany2003b}.

% Conclusions
\subsection*{Conclusions}

General examples of departures from the \emph{reduction principle} are rare~\citep{Altenberg2017}.
However, it has been demonstrated that higher mutation, recombination, and migration rates are favored by selection in populations evolving under fluctuating selection; see~\citet{Carja2014} and references therein.
Here we have provided another general example, which suggests that a modifier allele that prompts maladapted or below-average individuals increase the rate at which variation is generated, will be favored by selection and will lead to increased population mean fitness.

\section*{Appendices}
% Appendix A: mean fitness
\subsection*{Appendix A}\label{sec:AppA}

\begin{lemma}
The normalizing factor $\bar{w}$ in Eq.~\ref{eq:model} is the population mean fitness
\begin{equation}
\bar{w} = \sum_k{f_k D_k}.
\end{equation}
\end{lemma}

\begin{proof}
By definition, the normalizing factor $\bar{w}$ ensures that $\sum_k{f'_k}=1$.
Denote $e = (1, ..., 1)$ the vector with ones at all positions and rewrite $e\tr f' = 1$.
Therefore, 
\begin{multline}\label{eq:mean_fitness}
\bar{w} = 
\bar{w} e\tr f' = 
e\tr (I - C + M C) D f = \\
(e\tr I - e\tr C + e\tr M C) D f = \\
(e\tr - e\tr C + e\tr C) D f = \\
e\tr D f = 
\diag{D} f = 
\sum_k{f_k D_k},
\end{multline}
using the fact that $e\tr M = e\tr$ and $e\tr I = e\tr$ because $M$ and $I$ are stochastic matrices.
\end{proof}

Note that this lemma also ensures that the stable population mean fitness $\bar{w}^*=\sum_k{v_k D_k}$ is the leading eigenvalue of $(I - C + M C) D$; see Eq.~\ref{eq:model_equilibrium} and the \emph{Perron-Frobenius theorem}~\cite[Appendix~A]{Otto2007}.

% Appendix B: Caswell's formula
\subsection*{Appendix B}\label{sec:AppB}

\citet{Caswell1978} gave a \emph{formula for the sensitivity of the population growth rate to changes in life history parameters}.
In this formula, the \emph{population growth rate} is the leading eigenvalue of the population transformation matrix $T$, the \emph{life history parameters} are elements of $T$, and the \emph{sensitivity} is the derivative of the former with respect to the latter.
This is a useful formula~\citep{Caswell1978,Hermisson2002,Ram2012}, and therefore we reproduce it here.

\begin{lemma}[Caswell's formula]
Let $T$ be a non-negative matrix with leading eigenvalue $\lambda$ and left and right eigenvectors $u$ and $v$ such that $\sum{v_k}=1$ and $u\tr v = \sum{u_k v_k} = 1$.
Then the sensitivity of $\lambda$ to changes in any element $t$ of the matrix $T$ is
\begin{equation}\label{eq:Caswells_formula}
\frac{\partial \lambda}{\partial t} = 
u\tr \frac{\partial T}{\partial t} v
\end{equation}
\end{lemma}

\begin{proof} 
Using the lemma assumptions,
$\lambda = \lambda u\tr v = u\tr \lambda v = u\tr T v$ and differentiating both sides we get $\partial \lambda = \partial (u\tr T v)$.
Using the product rule (once in each direction),

\begin{multline}
\partial (u\tr T v) = 
\partial u\tr T v + u\tr \partial T v + u\tr T \partial v = \\
u\tr \partial T v + \partial u\tr \lambda v  + \lambda u\tr \partial v = \\
u\tr \partial T v + \lambda(\partial u\tr v  + u\tr \partial v) = \\
u\tr \partial T v + \lambda \partial(u\tr v).
\end{multline}

Because $u\tr v = 1$,
we have $\partial (u\tr v) = 0$ and
$\partial \lambda = u\tr \partial T v$.
\end{proof}

% Appendix C: Fisher's reproductive value
\subsection*{Appendix C}\label{sec:AppC}
\begin{remark}[Fisher's reproductive value]
Let $M$ be a stochastic matrix and $D$ be a diagonal matrix with positive diagonal elements. 
The elements of the left \emph{Perron} eigenvector $u$ of the matrix $MD$ can be regarded as \emph{Fisher's reproductive values}~\citep[pg.~27]{Fisher1930}
\end{remark}

\emph{Fisher's reproductive values} can be understood as follows~\citep{Grafen2006}.
Consider the dynamics not of frequencies but of absolute population sizes such that the vector of the number of individuals of each type at time $t$ is $n(t)$ and the corresponding frequencies are $f_k(t) = n_k(t) / \sum_i{n_i(t)}$.
The dynamics are
\begin{equation}
n(t) = (MD)^t n(0).
\end{equation}

Let $n(k, t)$ be the vector when the initial population is a single individual of type $k$.
The dynamics are
\begin{equation}
n(k,t) = (MD)^t e_k,
\end{equation}
where $e_k$ is a vector with 1 at position $k$ and 0 elsewhere.

The total population size at time $t$ starting with type $k$ is then
\begin{equation}
N(k,t) = \sum_i{n_i(k,t)} = e\tr (MD)^t e_k.
\end{equation}

Now we can compare the sizes of populations based on what type they started
with:
\begin{equation}
\frac{N(j,t)}{N(k,t)} = \frac{e\tr (MD)^t e_j}{e\tr (MD)^t e_k}.
\end{equation}

Now write $MD$ in its Jordan canonical form 
\begin{equation}
A = V \Lambda U\tr,
\end{equation}
where $V$ is the matrix of right (column) eigenvectors of $MD$,
$U\tr$ is the transposed matrix of left (row) eigenvectors of $MD$,
where we can take $V U\tr = U\tr V = I$, 
and $\Lambda$ is the diagonal matrix of eigenvalues of $A$ 
(for a non-generic set of matrices $M$, the geometric and algebraic multiplicities of the eigenvalues of $MD$ differ, and $\Lambda$ will not be a diagonal matrix, a case we can ignore).

Hence,
\begin{multline}
N(k, t) = 
e\tr (MD)^t e_k =
e\tr  (V \Lambda U\tr)^t e_k = \\
e\tr V \Lambda^t U\tr e_k.
\end{multline}

For the ratio, we can divide $\Lambda$ by $\lambda_1 = \rho(MD)$,
the spectral radius of $MD$:
\begin{multline}
\frac{N(j,t)}{N(k,t)} =
\frac{ e\tr V \Lambda^t U\tr e_j}{ e\tr V \Lambda^t U\tr e_k} = \\
\frac{ e\tr V \diag{1, \Big(\frac{\lambda_2}{\lambda_1}\Big)^t, \cdots} U\tr e_j} { e\tr V \diag{1,\Big(\frac{\lambda_2}{\lambda_1}\Big)^t, \cdots} U\tr e_k}.
\end{multline}
Now take the limit $t \goesto \infty$.
By assumption, $MD$ is irreducible, so $\lambda_i < \lambda_1$ for all $i > 1$.
Therefore,
\begin{equation}
\lim_{t \goesto \infty} \Big( \frac{\lambda_k}{\lambda_1} \Big)^t = 0
\end{equation}
for all $k > 1$, and
\begin{equation}
\lim_{t \goesto \infty}\frac{N(j,t)}{N(k,t)} =
\frac{e\tr V (e_1 e_1\tr) U\tr e_j} { e\tr V (e_1 e_1\tr) U\tr e_k} = 
\frac{ e\tr v u_j} { e\tr v  u_k} =
\frac{u_j} {u_k}.
\end{equation}

The vector $u$ is the left \emph{Perron} eigenvector of $MD$, and $u_k$ is $k$-th element of $u$.
This is why the value $u_k$ can be interpreted as the \emph{reproductive value} of type $i$: it is a weighting for the size of the population generated by a single individual of type $k$.

If we begin with a population at the equilibrium distribution $v$,
and ask what fraction of long-term descendants descended from type $k$ at that time,
we weight the equilibrium frequency $v_k$ by the reproductive value $u_k$, to get $u_k v_k$.
$\{u_k v_k\}_{k}$ is a probability distribution, since
\begin{equation}
\sum_k {u_k v_k} = u\tr v = 1.
\end{equation}
\citet{Hermisson2002} called this distribution the \emph{ancestor} or \emph{ancestral distribution}.

% Appendix D: inner stability
\subsection*{Appendix D}\label{sec:AppD}
\begin{lemma}[Stability of the equilibrium $v$]
The equilibrium $v$ of the system in Eq.~\ref{eq:model_equilibrium} is locally stable.
In addition,
\begin{enumerate}
\item If $M$ is irreducible and $D$ and $C$ are positive, then the equilibrium is globally stable.
\item If $M$ is irreducible and either $D$ or $C$ are non-negative but not strictly positive, then the equilibrium is globally stable except possibly for initial conditions on the boundary, i.e., when starting with zero elements in the initial frequency vector.
\end{enumerate}
\end{lemma}
\begin{proof}
Set $A=(I-C+MC)D$ and rewrite Eq.~\ref{eq:model} such that $f(t)$ is the frequency vector at time $t$ and
\begin{equation}
f(t) = \frac{Af(t-1)}{\norm{Af(t-1)}},
\end{equation}
where $\norm{f(t)} = \sum_{k=1}^{n}f_k(t)$.
Denote the eigenvalues of $A$ as $\lambda_1, \ldots, \lambda_n$ such that $\abs{\lambda_1} \ge \ldots \ge \abs{\lambda_n}$ and $\lambda_1$ is the \emph{Perron} leading eigenvalue, that is, the largest real eigenvalue with corresponding real non-negative right eigenvector $v$ ($\lambda_1$ is shown in~\nameref{sec:AppA} to be the stable population mean fitness $\bar{w}^*$).

First, note that the normalization $x \goesto \frac{1}{\norm{x}}$ can be applied once instead of $t$ times~\citep[Appendix~A]{Wakano2004}, that is,
\begin{equation}
f(t) = \frac{A^t f(0)}{\norm{A^t f(0)}}.
\label{eq:ftplus1}
\end{equation}

We write $f(0)$ as a linear combination of eigenvectors $v^k$ of $A$ for $k=1, \ldots, n$:
\begin{equation}
f(0) = a_1 v^1 + a_2 v^2 + \ldots + a_n v^n,
\label{eq:linear_combination}
\end{equation}
such that the eigenvector corresponding to the leading eigenvalue is $v=v_1$.

To proceed we need to make sure that $a_1 \ne 0$.
If $M$ is reducible then $A$ is reducible. 
In this case, $a_1 \ne 0$ can be guaranteed by setting $f(0)=v + \epsilon$ such that $\epsilon_k$ is small enough and $v_k+\epsilon_k \ge 0$ for all $k$, and $\sum_{k=1}^{n}{\epsilon_k} = 0$.

If $M$ is irreducible and $D$ and $C$ are positive, then $A$ is irreducible and  any choice of $f(0)$ guarantees $a_1 \ne 0$.

If $M$ is reducible and either $D$ or $C$ are non-negative but not strictly positive, than any choice of $f(0)$ such that $f_k(0)>0$ for all $k$ guarantees $a_1 \ne 0$.

We write, using Eq.~\ref{eq:linear_combination},
\begin{multline}
A^t f(0) = 
a_1 A^t v^1 + a_2 A^t v^2 + \ldots + a_n A^t v^n = \\
a_1 \lambda_1^t v^1 + a_2 \lambda_2^t v^2 + \ldots + a_n \lambda_n^t v^n = \\
\lambda_1^t \bigg(a_ 1v^1 + a_2 \bigg(\frac{\lambda_2}{\lambda_1}\bigg)^t v^2 + \ldots +  a_n \bigg(\frac{\lambda_n}{\lambda_1}\bigg)^t v^n\bigg).
\end{multline}
Therefore,
\begin{equation}
\frac{A^t f(0)}{\lambda_1^t} \goesto a_1 v_1
\end{equation}
as $t \goesto \infty$, because $\abs{\frac{\lambda_k}{\lambda_1}} < 1$
for all $k=2, \ldots, n$.
Finally, 
\begin{equation}
f(t) = 
\frac{A^t f(0)}{\norm{A^t f(0)}} =
\frac{\frac{A^t f(0)}{\lambda_1^t}}{\norm{\frac{A^t f(0)}{\lambda_1^t}}} \goesto
\frac{a_1 v^1}{\norm{a_1 v^1}} = v,
\end{equation}
as $t \goesto \infty$, which completes the proof.
\end{proof}

% Acknowledgements
{\small
\section*{Acknowledgements}

This research was supported in part by the Stanford Center for Computational, Evolutionary and Human Genomics, and by the Morrison Institute for Population and Resources Studies, Stanford University.
}

\bibliographystyle{agsm}
\bibliography{/Users/yoavram/Documents/library}
%\bibliography{ms}

\end{document}  