\documentclass[12pt, twocolumn]{extarticle}
\usepackage{geometry}
\geometry{
a4paper,
total={170mm,257mm},
left=20mm,
top=20mm,
headheight=12pt
}

%\usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx} % Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
% TeX will automatically convert eps --> pdf in pdflatex		

\usepackage{amssymb,amsmath,amsthm}
\usepackage{commath}
\usepackage{longtable}
\usepackage[hyphens]{url}
\usepackage[dvipsnames]{xcolor}
\usepackage[unicode=true,colorlinks=true,urlcolor=CadetBlue,citecolor=black,linkcolor=black]{hyperref}
\PassOptionsToPackage{hyphens}{url} % url is loaded by hyperref
\usepackage[auth-sc]{authblk}

%SetFonts
% newtxtext+newtxmath
\usepackage{newtxtext} %loads helv for ss, txtt for tt
\usepackage{amsmath}
\usepackage[bigdelims]{newtxmath}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
%SetFonts

% Yoav & Lee commands
\newcommand*{\tr}{^\intercal}
\let\vec\mathbf
\newcommand{\matrx}[1]{{\left[ \stackrel{}{#1}\right]}}
\newcommand{\diag}[1]{\mbox{diag}\matrx{#1}}
\newcommand{\goesto}{\rightarrow}
\newcommand{\dspfrac}[2]{\frac{\displaystyle #1}{\displaystyle #2} }
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\newtheorem{lemma}{Lemma}
\newtheorem{remark}{Remark}
\newtheorem{result}{Result}
\renewcommand\qedsymbol{} % no square at end of proof
\newcommand{\cl}{\mathbf{L}}
\newcommand{\cj}{\mathbf{J}}
\newcommand{\ci}{I}

% NatBib
\usepackage[round,colon,authoryear]{natbib}

% Title page
\title{Generation of Variation and a Modified Mean Fitness Principle: \\ Necessity is the Mother of Genetic Invention}
%\title{Conditional Generation of Variation and Mean Fitness Increase: \\ Necessity is the Mother of Genetic Invention}
% \title{A General Principle for the Evolution of Fitness-Associated Generation of Variation}

\author[a]{Yoav Ram}
\author[b]{Lee Altenberg}
\author[c]{Uri Liberman}
\author[a]{Marcus W. Feldman}
\affil[a]{Department of Biology, Stanford University, Stanford, CA}
\affil[b]{Information and Computer Sciences, University of Hawai`i at M{\=a}noa, Honolulu, HI}
\affil[c]{School of Mathematical Sciences, Tel Aviv University, Israel}

\date{\today}

% Document
\begin{document}
\maketitle

% Abstract
\begin{abstract}
Generation of variation may be detrimental in well-adapted populations evolving under constant selection.
In a constant environment, genetic modifiers that reduce the rate at which variation is generated by processes such as mutation and migration, succeed.
However, departures from this \emph{reduction principle} have been demonstrated.
Here we analyze a general model of evolution under constant selection where the rate at which variation is generated depends on the individual.
We find that if a modifier allele increases the rate at which individuals of below-average fitness generate variation, then it will increase in frequency and increase the  population mean fitness. This principle applies to phenomena such as stress-induced mutagenesis and condition-dependent dispersal, and exemplifies \emph{``Necessity is the mother of genetic invention.''}
\end{abstract}

% Introduction
\section*{Introduction}

According to the \emph{reduction principle}, in populations at a balance between natural selection and a process that generates variation (i.e. mutation, migration, or recombination), selection favors neutral modifiers that decrease the rate at which variation is generated. 
The \emph{reduction principle} was demonstrated for modifiers of  recombination~\citep{Feldman1972}, mutation~\citep{Liberman1986a}, and migration~\citep{Feldman1986}.
These results were unified in a series of studies ~\citep{Altenberg1984,Altenberg1987,Altenberg2009,Altenberg2012b,Altenberg2012a,Altenberg2017}.

The latter studies have established the conditions for a \emph{unified reduction principle} by neutral genetic modifiers:
(i) effectively infinite population size, (ii) constant-viability selection, (iii) a population at an equilibrium, and (iv) \emph{linear variation} -- the equal scaling of transition probabilities by the modifier, i.e., the modifier has the same effect on all individuals.
A departure from the latter assumption occurs if two variation-producing processes interact~\citep{Feldman1980,Altenberg2012b}.
Departures from the \emph{reduction principle} have also been demonstrated when conditions (i)-(iii) are not met, see for example~\citet{Holsinger1986} and references therein.

Another departure from the \emph{linear variation} assumption of the \emph{reduction principle} for mutation rates involves a mechanism by which the mutation rate increases in individuals of low fitness -- a mechanism first observed in stressed bacteria~\citep{Foster2007}, although not in a constant environment. A modifier gene that changes transition rates in only a subset of types exemplifies the \emph{principle of partial control} \citep{Altenberg1984,Altenberg2012a} a general statement about non-linear variation, which proposes that, ``When the modifier gene has only partial control over the
transformations occurring at loci under selection, then it may be possible for the part which it controls to evolve an increase in rates.''

\citet{Ram2012} demonstrated that even in a constant environment, increasing the mutation rate of individuals with below-average fitness increases the population mean fitness, rather than decreases it.
Their analysis assumed  infinite population size and fitness  determined by the number of mutant alleles accumulated in the genotype.
In their models, the only departure from the \emph{reduction principle} conditions was the unequal scaling of mutation probabilities between different genotypes introduced by the correlation between the mutation rate and fitness.
A similar result has been demonstrated for conditional dispersal~\citep[Th.~39]{Altenberg2012b}, fitness-associated recombination~\citep{Hadany2003a} and for condition-dependent sexual reproduction~\citep{Hadany2007a}, and empirical evidence suggests these mechanisms are common in nature~\citep{Ram2016}.

\citet{Ram2012} stated that their result represents a departure from the \emph{reduction principle}, but did not explain this departure.
Their analysis was specific to a model that classified individuals by the number of mutant alleles in their genotype, similar to models studied by~\citet{Kimura1966a} and~\citet{Haigh1978}.
Moreover, their argument was based on the expected increase of the stable population mean fitness, rather than on the invasion success of modifier alleles that modify the mutation rate~\citep[i.e., analysis of \emph{evolutionary genetic stability}, see][]{Eshel1982, Lessard1990}.

Here, we present an evolutionary model in which the type of the individual determines both its fitness and the rate at which it generates variation.
Our results show that the population mean fitness increases if individuals with below-average fitness produce more variation than individuals with above-average fitness,
and that modifier alleles that induce below-average individuals to produce more variation are favored by natural selection.

% Model
\section*{Models}\label{sec:models}

\paragraph*{General model.}\label{sec:general_model}
Consider a large  population with an arbitrary set of types $A_1, A_2, \ldots, A_n$.
The frequency and fitness of individuals of type $A_k$ are $f_k$ and $w_k$, respectively.
The probability that an individual of type $A_k$ will transition to some other type is $C_k$, and given a transition occurs, the probability that it will transition to type $A_j$ is $M_{j,k}$.
Therefore, the change in the frequencies of type $A_k$ is described by the transformation $f \to f'$: 
\begin{equation}
\bar{w} f'_k = (1-C_k) w_k f_k + \sum_{j=1}^{n}{C_j M_{k,j} w_j f_j},
\label{eq:model_sum}
\end{equation}
or in matrix form (introduced to describe conditional dispersal in \citet{Altenberg2012a})
\begin{equation}
\bar{w} f' = (\ci - C + MC)D f,
\label{eq:model}
\end{equation}
where $f=(f_1, f_2, \ldots, f_n)$ is a frequency vector with $f_k\ge 0$ and  $\sum_{k=1}^n{f_k} = 1$;
$D$ is a positive diagonal matrix with entries $w_k$ such that $w_k \ne w_j$ for some $k \ne j$; 
$C$ is a positive diagonal  matrix with entries $C_k$, where $C_k<1$ for at least one $k$;
$M$ is an irreducible  column-stochastic matrix: $M_{j,k} \ge 0$ for all $j,k$, $\sum_{j=1}^n {M_{j,k}} = 1$ for all $k$, and $(M^{\ell})_{j,k} > 0$ for all $j,k$ for some positive integer $\ell$ (the latter is the condition for primitivity~\citep[see][Appendix 3]{Otto2007});
$\ci$ is the $n\times n$ identity matrix;
and $\bar{w}$ is the normalizing factor such that $\sum_{k=1}^n{f'_k}=1$ and is equal to the population mean fitness $\bar w=\sum_{k=1}^n f_kw_k$.

The types $A_k$ can represent a single or multiple haploid genetic loci or non-genetic traits.
Importantly, type transmission is vertical and uni-parental (the type is transmitted from a single parent to the offspring) and is independent of the frequencies of the other types.
This model precludes processes such as recombination, social learning, sexual outcrossing, and horizontal or oblique transmission, as these processes are frequency-dependent~\citep[pg.~54]{Cavalli-Sforza1981}.

Transition between types is determined by a combination of two effects:
(i) the probability of transitioning \emph{out} of type $A_k$ is determined by $C_k$;
(ii) given a transition out of type $A_k$, the distribution of the destination types $A_i$ is given by $M_{i,k}$ (note the index order).
Importantly, different types can have different rates.
That is, $C_i \ne C_j$ for some $i,j$. The case $C_i = C_j$ for all $i,j$ is covered by the \emph{reduction principle}~(see \citealt{Altenberg1984,Altenberg1987,Altenberg2009,Altenberg2017}).

In the following section we present four examples of the model (Eq.~\ref{eq:model}) that apply to mutation, migration, and learning.

% Mutation model 1
\paragraph*{Mutation model 1.}\label{sec:mut_model_1}

Here we consider a large population of haploids and a trait determined by a single genetic locus with $n$ possible alleles $A_1, A_2, \ldots, A_n$ and corresponding fitness values $w_1, w_2, \ldots, w_n$.
The mutation rates $C_k$ of individuals with allele $A_k$ are potentially different;
specifically, with probability $1-C_k$, the allele $A_k$ does not mutate, and with probability $\frac{C_k}{n-1}$, the allele $A_k$ mutates to $A_j$ for any $j \ne k$.
This is an extension of a model studied by~\citet{Altenberg2017} that allows for the mutation rate of $A_k$, $C_k$, to depend on properties of the allele $A_k$.

Let the frequency of $A_k$ in the present generation be $f_k$ with $f_k \ge 0$ and $\sum_{k=1}^{n}{f_k}=1$.
Then after selection and mutation, $f'_k$ in the next generation is given by
\begin{equation}
f_k' = \big(1 - C_k\big) \frac{w_k}{\bar{w}} f_k + \frac{1}{n-1} \sum_{j \ne k}{C_j \frac{w_j}{\bar{w}} f_j},
\label{eq:mutation_model_1}
\end{equation}
for  $k=1, 2, \ldots, n$, where $\bar{w} = \sum_{k=1}^{n}{f_k w_k}$ is the population mean fitness.

This model is a special case of the general model (Eq.~\ref{eq:model}) where
\begin{equation} 
{M} = \frac{1}{n-1} \begin{bmatrix}
0 & 1 & 1 & \ldots & 1 \\
1 & 0 & 1 & \ldots & \vdots \\
1 & 1 & 0 & \ldots & \vdots \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
1 & \ldots & \ldots & \ldots & 0
\end{bmatrix},
\end{equation}
with zeros on the diagonal and $\frac{1}{n-1}$ elsewhere.
Note that here ${M}$ is primitive (i.e., irreducible and aperiodic).% Mutation model 2
\paragraph*{Mutation model 2.}\label{sec:mut_model_2}

Again, we consider a large population of haploids, but here individuals with genotype $A_k$ are characterized by the number $k$ of deleterious or mutant alleles in their genotype, where $0 \le k \le n$.
Specifically, the fitness of individuals with $k$ mutant alleles is $w_k$ ($w_0 > w_1 > \ldots > w_n$),
and the probability $C_k$ that a mutation occurs in individuals with $k$ mutant alleles depends on $k$.
When a mutation occurs it is \emph{deleterious} with probability $\delta$, generating a mutant allele and converting the individual from $A_k$ to $A_{k+1}$,
or it is \emph{beneficial} with probability $\beta$, converting the individual from $A_k$ to $A_{k-1}$.
Note that such beneficial mutations can be either compensatory or back-mutations, and that mutations are neutral with probability $1-\delta-\beta$.
We assume that both the deleterious and the beneficial mutation rates are low enough that two mutations are unlikely to occur in the same individual in one generation: $C_k(\delta + \beta) \ll 1$ for all $k=1, \ldots, n$.
This model has been analyzed by~\citet{Ram2012}.

Let the frequency of $A_k$ in the present generation be $f_k$ with $f_k \ge 0$ and $\sum_{k=0}^{n}{f_k}=1$.
Then after selection and mutation $f'_k$ in the next generation is given by
\begin{equation}
\begin{aligned}
f_0' &= \big(1 - \delta C_0\big) \frac{w_0}{\bar{w}} f_0 + \beta C_{1} \frac{w_{1}}{\bar{w}} f_{1}, \\
f_k' &= \big(1 - (\delta+\beta) C_k\big) \frac{w_k}{\bar{w}} f_k + \\
	 & \delta C_{k-1} \frac{w_{k-1}}{\bar{w}} f_{k-1} + 
	 \beta C_{k+1} \frac{w_{k+1}}{\bar{w}} f_{k+1}, \\
f_n' &= \big(1 - \beta C_n\big) \frac{w_n}{\bar{w}} f_n + \delta C_{n-1} \frac{w_{n-1}}{\bar{w}} f_{n-1},	 
\end{aligned}
\label{eq:mutation_model_2}
\end{equation}
for $k=1,2,\ldots, n-1$.
Here $\bar{w}=\sum_{k=0}^{n}{f_k w_k}$ is the population mean fitness.

Therefore, setting 
\begin{equation}
{M} = \begin{bmatrix}
1-\delta & \beta & 0 &  \cdots & 0\\
\delta & 1-\delta-\beta & \beta &  \ddots & 0\\
0 & \delta & 1-\delta-\beta & \ddots & 0 \\
\vdots & \ddots & \ddots & \ddots & \beta \\
0 & 0 & 0 & \delta & 1-\beta
\end{bmatrix},
\end{equation}
with the beneficial, neutral, and deleterious mutation probabilities on the three main diagonals and zeros elsewhere, 
Eq.~\ref{eq:mutation_model_2} can be viewed as a special case of Eq.~\ref{eq:model}.
Here, too, ${M}$ is primitive as long as $\delta, \beta > 0$.

% Migration model
\paragraph*{Migration model.}\label{sec:mig_model}

In this case we consider a large population of haploids that occupy $n$ demes, $A_1, \ldots, A_n$.
Let the frequencies of individuals in deme $A_k$ be $f_k$ with $f_k \ge 0$ and $\sum_{k=1}^{n}{f_k} = 1$.
The fitness of individuals in deme $A_k$ is $w_k$, but the entire population comes together for reproduction, and therefore reproductive success is determined by competition among individuals of all demes -- this has been termed \emph{hard selection}~\citep{Wallace1975,Karlin1982}.

After reproduction, offspring of individuals from deme $A_k$ return to their parental deme with probability $1-C_k$, or migrate to a different deme $A_j$ with probability $C_k M_{j,k}$, where the matrix $M$ is irreducible, $C_k > 0$, $C\ne I$, $M_{j,k} \ge 0$, and $\sum_{j=1}^{n}{M_{j,k}} = 1$ for all $k=1, \ldots, n$.
Therefore, $1-C_k$ can be interpreted as a \emph{homing rate}. When the homing rate differs for different demes, it has been called \emph{conditional dispersal} \citep{McPeek1992,Kirkland2006}.

Following selection and migration the new frequencies $f'_k$ are given exactly by Eq.~\ref{eq:model_sum}.
If the columns of ${M}$ are identical
\begin{equation}
{M} = \begin{bmatrix}
m_1 & m_1 & \ldots & m_1 \\
m_2 & m_2 & \ldots & m_2 \\
\vdots & \vdots & \vdots & \vdots \\
m_n & m_n & \ldots & m_n
\end{bmatrix},
\end{equation}
with $m_k>0$ and $\sum_{k=1}^{n}{m_k}=1$,
then $m_k$ can be considered the relative population size of deme $A_k$ --
this is the non-homogeneous extension of Deakin's \emph{homing model}~\citep{Deakin1966,Karlin1982}.

Similarly, if demes are arranged in a circle, for example around a lake, 
then we can denote the probability $p_k$ of migrating $k$ demes away from the parental deme (conditioned on migration which occurs with probability $C_k$)
and ${M}$ takes the form
\begin{equation}
{M} = \begin{bmatrix}
p_0 & p_1 & \ldots & p_{n-1} \\
p_{n-1} & p_0 & \ldots & p_{n-2} \\
\vdots & \vdots & \ddots & \vdots \\
p_1 & p_2 & \ldots & p_0
\end{bmatrix},
\end{equation}
where $p_k > 0$ and $\sum_{k=0}^{n-1}{p_k}=1$.

% Learning model
\paragraph*{Learning model.}\label{sec:learn_model}

In our final example, we consider a large population and an integer phenotype $k$ where $1 \le k \le n$.
Individuals are characterized by their initial and mature phenotypes~\citep[pg.~94]{Boyd1988}.
Fitness is determined by the mature phenotype: the fitness of an individual with mature phenotype $k$ is $w_k$.

An offspring's initial phenotype is acquired by learning the mature phenotype of its parent (assuming uni-parental transmission).
In individuals with initial phenotype $k$, the mature phenotype is the same as the initial phenotype with probability $1-C_k$, and is modified by individual learning or \emph{exploration}~\citep{Borenstein2008} with probability $C_k$.
Such individual exploratory learning, which can be considered either intentional or the result of incorrect learning, modifies initial phenotype $k$ to mature phenotype $j$ with probability $M_{j,k}$.

Therefore, if the frequency of individuals with mature phenotype $k$ in the current generation is $f_k$, then the frequency in the next generation $f'_k$ is
\begin{equation}
f'_k = (1-C_k) f_k \frac{w_{k}}{\bar{w}} + \sum_{j=1}^{n}{C_j M_{k,j} \frac{w_{j}}{\bar{w}} f_j },
\end{equation}
where $\bar{w} = \sum_{k=1}^{n}{f_k w_{k}}$ is the population mean fitness.

When $C_k = \tau$ for all $k$ and fitnesses are not all equal, then a culturally transmitted variant in $\tau$ will spread if and only if $\tau$ is reduced, the first manifestation of the reduction principle shown in cultural evolution \citep[pp. 203--206]{Altenberg1984}.  

In a more specific example, for the case of \emph{symmetric individual learning}~\citep{Borenstein2008}, learning is parameterized by its breadth of exploration $b$ and the mature phenotype $j$ is randomly drawn from $2b+1$ phenotypes symmetrically and uniformly distributed around the initial phenotype $k$, with the limitation that any "spillover" of phenotypes below $1$ or above $n$ is "absorbed" by those boundaries.
This "absorption" ensures $M$ is column-stochastic. 
In other words, given initial phenotype $k$, the probability of maturation to phenotype $j$, where $k-b \le j \le k+b$ is $1/(2b+1)$, but any phenotype $j<1$ actually becomes $j=1$ and any phenotype $j>n$ actually becomes $j=n$.
The probability for maturation to other phenotypes is $0$.

For instance, with $n=5$ and $b=1$ we have
\begin{equation}
M = \begin{bmatrix}
2/3 & 1/3 & 0 & 0 & 0 \\
1/3 & 1/3 & 1/3 & 0 & 0 \\
0 & 1/3 & 1/3 & 1/3 & 0 \\
0 & 0 & 1/3 & 1/3 & 1/3 \\
0 & 0 & 0 & 1/3 & 2/3
\end{bmatrix},
\end{equation}
and with $n=6$ and $b=2$ we have
\begin{equation}
M = \begin{bmatrix}
3/5 & 2/5 & 1/5 & 0 & 0 & 0 \\
1/5 & 1/5 & 1/5 & 1/5 & 0 & 0 \\
1/5 & 1/5 & 1/5 & 1/5 & 1/5 & 0 \\
0 & 1/5 & 1/5 & 1/5 & 1/5 & 1/5 \\
0 & 0 & 1/5 & 1/5 & 1/5 & 1/5 \\
0 & 0 & 0 & 1/5 & 2/5 & 3/5
\end{bmatrix}.
\end{equation}

% Results
\section*{Results}

% Mean fitness principle
\paragraph*{A modified mean-fitness principle.}

We first focus on the stable population mean fitness.
We  show that if the transition rate from types with below-average fitness increases, then the stable population mean fitness increases, too.  We refer to this as a ``modified'' mean fitness principle (MMFP) because for modifiers of mutation and migration rates the standard mean fitness principle involves a decrease in the mean fitness with increasing rates.

Write the equilibrium  frequency vector $f$ in Eq.~\ref{eq:model} as $\hat v$ and the stable population mean fitness as $\hat{\bar w}$, then
\begin{equation}\label{eq:model_equilibrium}
\hat{\bar w} \hat v = (I-C+MC)D \hat v.
\end{equation}
Note that (i) the existence and uniqueness of $\hat{\bar w}$ and $\hat v$ are guaranteed by the \emph{Perron-Frobenius theorem}~~\citep[][Appendix 3]{Otto2007} because $(I-C+MC)D$ is a non-negative primitive matrix; 
(ii) the global stability of this equilibrium is proven in~\nameref{sec:AppC}.

The following result constitutes an MMFP for the
direction of the sensitivity of the equilibrium mean fitness $\hat{\bar w}$ to changes
in $C_k$, the probability of transition from $A_k$.
\medskip

\begin{result}[Modified mean fitness principle]\label{result:mfp}
Let $\hat{\bar w}$ be the leading eigenvalue of $(I-C+MC)D$,
and $\hat u$ and $\hat v$ be the corresponding positive left and right eigenvectors, such that $\sum_{k=1}^{n}\hat v_k=1$ and $\sum_{k=1}^{n}\hat u_k\hat v_k=1$.
Then,
\begin{equation}\label{eq:mfp}
\frac{\partial \hat{\bar w}}{\partial C_k} = 
\frac{\hat u_k \hat v_k}{C_k} (\hat{\bar w} - w_k),
\end{equation}
or in simpler terms,
\begin{equation}\label{eq:mfp_sign}
sign\frac{\partial \hat{\bar w}}{\partial C_k} = 
sign(\hat{\bar w} - w_k).
\end{equation}

Therefore increased transition from type $k$ will increase the stable population mean fitness if the fitness of type $k$ is below the stable population mean fitness.
\end{result}

\begin{proof}
Following the analysis in \citet [Th.~39]{Altenberg2012a}, we apply to \eqref {eq:model_equilibrium} the formula in~\citet{Caswell1978} (see eq.~\ref{eq:Caswells_formula} in~\nameref{sec:AppA}),
\begin{equation}
\frac{\partial \hat{\bar w}}{\partial C_k} = 
\hat u\tr \frac{\partial (I-C+MC)D}{\partial C_k} \hat v.
\end{equation}

Let $e_k$ and $e\tr_k$ be the column and row vectors with 1 at position $k$ and 0 elsewhere, $Z_k = e_k e\tr_k$ be the matrix with 1 at position $(k,k)$ and 0 elsewhere, and $[M]_k$ be the $k$-th column of $M$.

Then,
\begin{multline}\label{eq:mfp_intermediate}
%\begin{aligned}
\hat u\tr \frac{\partial (I-C+MC)D}{\partial C_k} \hat v = 
\hat u\tr (0 - Z_k + M Z_k)D \hat v = \\
-\hat v_k \hat u_k w_k + \hat v_k w_k \hat u\tr[M]_k = \\
\hat v_k w_k (\hat u\tr[M]_k - \hat u_k). 
%\end{aligned}
\end{multline}

The corresponding equation to Eq.~\ref{eq:model_equilibrium} for the left
eigenvector $u$ is 
\begin{equation}
\hat u\tr \hat{\bar w} = \hat u\tr (I - C + MC) D,
\end{equation}
which gives us a relation between $\hat{\bar w}$ and the $k$
element of $\hat u$:
\begin{equation}
\hat u_k \hat{\bar w} = (1-C_k) w_k \hat u_k + C_k w_k \hat u\tr [M]_k.
\end{equation}
Multiplying both sides by $\hat v_k$  and rearranging, we get 
\begin{equation}
\frac{\hat u_k \hat v_k}{C_k} (\hat{\bar w} - w_k) = \hat v_k w_k (\hat u\tr [M]_k - \hat u_k),
\end{equation}
which when substituted into Eq.~\ref{eq:mfp_intermediate} yields:
\begin{equation}
\frac{\partial \hat{\bar w}}{\partial C_k} = 
\frac{\hat u_k \hat v_k}{C_k} (\hat{\bar w} - w_k).
\end{equation}
Finally, since $\hat u_k, \hat v_k, C_k > 0$, we have
\begin{equation}
sign \frac{\partial \hat{\bar w}}{\partial C_k} = 
sign (\hat{\bar w} - w_k),
\end{equation}
which completes the proof.
\end{proof}

The above result provides a condition for the effect of changing $C_k$, the probability for transition from $A_k$, on the stable population mean fitness.
Specifically, if $A_k$ individuals have below-average fitness, then increasing $C_k$ will increase the population mean fitness.

% Multiple types
\paragraph*{}
We turn our attention to the case where the transition rates from a subset $K$ of the types are equal, that is, $C_j \equiv C_i$ for $i,j \in K$.
In this case, Eq.~\ref{eq:mfp} leads directly to the following by setting $\tau = C_i$ for $i\in K$.

\begin{corollary}
The sensitivity of the stable population mean fitness to change in the rate of transition $\tau$ from types in $K$ is
\begin{multline}\label{eq:mfp_K}
%\begin{aligned}
\frac{\partial \hat{\bar w}}{\partial \tau} = 
\hat u\tr \Big( \sum_{k \in K}{\frac{\partial (I - C + MC)D}{\partial \tau}} \Big) \hat v = \\
\frac{1}{\tau} \sum_{k \in K}{\hat u_k \hat v_k (\hat{\bar w} - w_k)},
%\end{aligned}
\end{multline}
and
\begin{multline}\label{eq:mfp_sign_threshold}
sign \frac{\partial \hat{\bar w}}{\partial \tau} = 
sign \sum_{k \in K}{\hat u_k \hat v_k (\hat{\bar w} - w_k)} = \\ 
sign \Big(\hat{\bar w} - \frac{\sum_{k \in K}{\hat u_k \hat v_k w_k}}{\sum_{k \in K}{\hat u_k \hat v_k}}\Big).
\end{multline}
\end{corollary}

Therefore, increased transition from types in $K$ will increase the stable population mean fitness if the average fitness of individuals descended from types in $K$ is below the stable population mean fitness.
For example, \citet[Appendix~B]{Ram2012} considered individuals that are grouped by the number of their accumulated mutant alleles, $k$ (see \nameref{sec:mut_model_2}), 
and the effect of increasing the mutation rate in individuals with at least $\pi$ mutant alleles.
According to Eq.~\ref{eq:mfp_sign_threshold}, this will result in increased stable population mean fitness if individuals with $\pi$ or more mutant alleles have below-average fitness. 

% Reproductive value principle
\paragraph*{Reproductive value principle.}

An interesting consequence of Eq.~\ref{eq:mfp_intermediate} observed in \citet [Th.~39]{Altenberg2012a} is
\begin{equation}
\begin{aligned}
\frac{\partial \hat{\bar w}}{\partial C_k} = 
\hat v_k w_k (\hat u\tr[M]_k - \hat u_k) = \\
w_k \Big(\sum_{j=1}^{n}{\hat u_j M_{j,k} \hat v_k} - \hat u_k \hat v_k\Big).
\end{aligned}
\end{equation}
Here, $\hat u_k$ can be regarded as the \emph{reproductive value} of type $k$~\citep[pg.~27]{Fisher1930}, which gives the relative contribution of type $k$ to the long-term population (see~\nameref{sec:AppB}).
Consequently, $\hat u_k \hat v_k$ is what ~\citet{Hermisson2002} call the \emph{ancestor frequency} of type $k$, which is better described as the fraction of the population in the distant future that descended from the individuals of type $k$ present at a particular moment in a population at equilibrium.
The sum $\sum_{j=1}^{n}{\hat u_j M_{j,k} \hat v_k}$ can be similarly interpreted as the fraction of the equilibrium population descended from individuals that transitioned from type $k$ to another type (via the $k$ column of the transition matrix $M$), conditioned on transition occurring.

Since $w_k>0$, from Eq.~\ref{eq:mfp_intermediate} we have the following corollary.

\begin{corollary}[Reproductive value principle]\label{cor:rvp}
In the notation of Result~\ref{result:mfp},
\begin{equation}
sign \frac{\partial \hat{\bar w}}{\partial C_k} = 
sign (\hat u\tr [M]_k - \hat u_k),
\end{equation}
where $[M]_k$ is the $k$-th column of $M$.

Therefore, increased transition from type $k$ will increase the stable population mean fitness if the fraction of the population descended from type $k$ is expected to increase due to a transition to another type. 
\end{corollary}

Corollary~\ref{cor:rvp} sheds light on why we require $M$ to be irreducible.
If $M$ is irreducible then individuals of type $k$ can transition into any other type in a finite number of generations.
So individuals with below-average fitness can have descendants with above-average fitness, and increased generation of variation in these individuals will increase the stable population mean fitness.
In contrast, if $M$ is not irreducible, it is possible that some individuals with below-average fitness are ``doomed'' since they cannot produce descendants with above-average fitness, so increasing the generation of variation in these individuals can only hasten their removal from the population, affecting the rate at which the population converges to the stable equilibrium, but not necessarily the stable population mean fitness.
For example, if we set $\beta=0$ in \nameref{sec:mut_model_2}, $M$ becomes triangular and reducible, and the stable mean fitness becomes $\bar{w} = (1-\delta C_0)w_0$, which is not affected by changes in $C_k$ for $k \ge 1$~\citep[see also][Fig.~1A]{Agrawal2002,Ram2012}.

% Evolutionary stability
\paragraph*{Evolutionary genetic stability.}

% Modifier model
We now focus on a neutral modifier locus completely linked to the types $A_k$, with no direct effect on fitness, and whose sole function is to determine $C_k$, the rates of transition from the different types.
We will show that modifier alleles that increase the stable population mean fitness in accordance with Result~\ref{result:mfp} are favored by natural selection.

\paragraph*{Modifier model.}
Consider the case of two modifier alleles, $b$ and $B$, inducing different transition probabilities $C=\diag{C_1, \ldots, C_n}$ and $\tilde{C}=\diag{\tilde{C}_1, \ldots, \tilde{C}_n}$, respectively.
The frequencies of type $A_k$ linked to modifiers $b$ or $B$ are $f_k$ and $g_k$, respectively, where $\sum_{k=1}^{n}{(f_k + g_k)}=1$.
$\bar{w}$ now ensures that $\sum_{k=1}^{n}{(f_k' + g_k')}=1$, 
and the rest of the model parameters are the same as in Eq.~\ref{eq:model}.

The frequencies in the next generation, $f'$ for allele $b$ and $g'$ for allele $B$, are given by
\begin{equation}
\begin{cases}
\bar{w} f' &= (I-C+MC)D f \\
\bar{w} g' &= (I-\tilde{C}+M\tilde{C})D g
\end{cases}.
\label{eq:modifier_model}
\end{equation}
Here, $\bar{w}=\sum_{k=1}^{n}{(f_k + g_k) w_k}$ is the mean fitness of the entire population. 
Note that Eq.~\ref{eq:model} is the special case of Eq.~\ref{eq:modifier_model} where allele $M$ is absent, i.e. $g_k=0$ for all $k$.

Result~\ref{result:mfp} provides a condition under which increasing the transition rate $C_k$ from type $A_k$ will increase the stable population mean fitness.
Could a modifier allele that increases $C_k$ increase in frequency when initially rare in the population?
To answer this we analyze the stability of resident modifier allele $b$ with transition rates $C_k$ to  invasion by a modifier allele $B$ with rates $\tilde{C}_k$ under Eqs.~\ref{eq:modifier_model}.

The equilibrium of Eqs.~\ref{eq:modifier_model} when modifier allele $B$ is absent from the population is $(\hat v,0)$, where $\hat v$ is given in Eq.~\ref{eq:model_equilibrium} and $g_k=0$ for all $k$. 
The stability of allele $b$ to invasion by allele $B$ is determined by the leading eigenvalue $\lambda_1$ of $\cl_{ex}$ the external stability matrix of the equilibrium $(\hat v,0)$, which, in turn, is determined by the Jacobian $\cj$ of the system in Eqs.~\ref{eq:modifier_model} evaluated at the equilibrium $(\hat v,0)$, where
\begin{equation}
\cj = \begin{pmatrix}\cl_{in} & 0 \\ 0 & \cl_{ex} \end{pmatrix},
\end{equation}
and $\cl_{in}$ is the local stability matrix of the equilibrium $(\hat v,0)$ in the space $\sum_{k=1}^n{f_k}=1$.
The zero block matrices are due to the complete linkage between the modifier and the types $A_k$ and to the lack of transition (i.e., mutation) between the modifier alleles.

$\cl_{ex}$ can be written as
\begin{equation}\label{eq:Lex}
\cl_{ex} = (I - \tilde{C} + M \tilde{C}) \tilde{D} ,
\end{equation}
where $\tilde{D} =D/\hat{\bar{w}}$ is the diagonal matrix with entries $w_k/\hat{\bar{w}}$ for all $k$, and $\hat{\bar{w}}$ is the stable population mean fitness in the absence of the modifier allele $B$.
$\lambda_1$, the leading eigenvalue of $\cl_{ex}$, coincides with $\tilde{\bar{w}}$, the maximal mean fitness associated with Eq.~\ref{eq:Lex}.
Thus we can apply Result~\ref{result:mfp} to $\lambda_1$ and obtain the following result.

\begin{result}[Evolution of increased genetic variation]
Let $\lambda_1$ be the leading eigenvalue of the external stability matrix $\cl_{ex}$.
If the transition rates induced by the modifier alleles $b$ and $B$ are equal, i.e., $\tilde{C}_k=C_k$ for all $k$, then 
\begin{equation}
\lambda_1=1,
\end{equation}
and
\begin{equation}
sign \frac{\partial \lambda_1}{\partial \tilde{C}_k}\bigg\rvert_{\tilde{C}_k = C_k} = 
sign(\hat{\bar w} - w_k).
\end{equation}

Therefore, an initially rare modifier allele $B$ with transition rates slightly different from the resident allele $m$ can successfully invade the population ($\lambda_1>1$) if $B$ increases the probability of transition from types with below-average fitness, thereby increasing the  mean fitness $\tilde{\bar w}$.
\end{result}

\begin{proof}
Substituting $\tilde{C}=C$ in Eq.~\ref{eq:Lex} and multiplying both sides by $\hat{\bar w}$,
\begin{equation}
\hat{\bar w} \cl_{ex}\big\rvert_{\tilde{C}_k = C_k} = (I-C+MC) D,
\end{equation}
and since $\hat{\bar w}$ is the leading eigenvalue of the RHS (see Eq.~\ref{eq:model_equilibrium}),
the leading eigenvalue of $\cl_{ex}\big\rvert_{\tilde{C}_k = C_k}$ is $\lambda_1=1$.

Now, applying Result~\ref{result:mfp} (eq.~\ref{eq:mfp_sign}) to Eq.~\ref{eq:Lex}, the sign of the derivative of $\lambda_1$ with respect to $\tilde{C_k}$ is
\begin{equation}
sign \frac{\partial \lambda_1}{\partial \tilde{C}_k} =
sign\left(\lambda_1 - \frac{w_k}{\hat{\bar w}}\right).
\end{equation}
Thus
\begin{equation}
\begin{aligned}
sign \left.\frac{\partial \lambda_1}{\partial \tilde{C}_k}\right\rvert_{\tilde{C}_k = C_k} = 
sign\left(1 - \frac{w_k}{\hat{\bar w}}\right) = \\
sign(\hat{\bar w} - w_k),
\end{aligned}
\end{equation}
since $\hat{\bar w}>0$.
This completes the proof.
\end{proof}

% Reduction principle & mutational loss
\paragraph*{Reduction principle and mutational loss.}

Note that if the modifier has the same effect on all types,
then we can substitute $C = \mu I$ (with $\mu > 0$) in Eq.~\ref{eq:model_equilibrium}, and proceeding as in Eq.~\ref{eq:mfp_K}, we find a relationship previously described by~\citet[eq.~24]{Hermisson2002},
\begin{equation}\label{eq:mutational_loss}
\frac{\partial {\bar{w}}}{\partial \mu} = 
-\frac{1}{\mu}\left(\sum_{k=1}^{n}  u_k  v_k w_k - {\bar{w}} \right) = -\frac{1}{\mu} G,
\end{equation}
where $u_k,v_k$ are computed at the equilibrium associated with $\mu$ and $\bar w$ is the mean fitness at that equilibrium. $G$ is the difference between the \emph{ancestral mean fitness} $(\sum_{k=1}^{n}  u_k  v_k w_k)$ and the \emph{stable population mean fitness} $({\bar{w}})$ when $C_k=\mu$, is  called the \emph{mutational loss}~\citep{Hermisson2002}.

If an invading  allele $B$ changes the transition probability from that of the resident allele $b$, i.e., $C_k=\mu$ and $\tilde C_k=\tilde\mu$, then $\cl_{ex}$ becomes
\begin{equation} \label{eq:Lex_mu}
\cl_{ex} = \bigl[(1 - \tilde\mu)I + \tilde\mu M\bigr] \tilde{D},
\end{equation} 
where $\tilde{D} =D/{\bar{w}}$ is  the diagonal matrix with entries $w_k/{\bar{w}}$ for all $k$.
Using the \emph{unified reduction principle}~\citep{Altenberg1984,Altenberg1987,Altenberg2009,Altenberg2017} the leading eigenvalue $\lambda_1=\lambda(\tilde\mu)$ of $\cl_{ex}$ satisfies $\partial\lambda_1/\partial\tilde\mu<0$, $\lambda_1(\tilde\mu)=1$ when $\tilde\mu=\mu$, and $\lambda_1(\tilde\mu)=\bar w(\tilde\mu)$. Thus we can conclude that the mutational loss $G$ is positive, the reduction principle holds, and the mean fitness is a decreasing function of $\tilde\mu$.

% Discussion
\section*{Discussion}

We have shown that under constant-viability selection and in an effectively infinite haploid population at mutation-selection or migration-selection equilibrium, the stable population mean fitness increases if individuals with below-average fitness increase the rate at which variation is generated. Furthermore, modifier alleles that  increase generation of variation in such individuals are favored by natural selection.
These results apply as long as there is a chance for the variation-generating process to transform an individual with below-average fitness into one with above-average fitness. 
This condition is satisfied by the requirement that $M$ in Eq.~\ref{eq:model} be irreducible. Further work will be required to find a sufficient and \emph{necessary} condition on $M$.
We refer to this as a ``modified mean-fitness principle'' because, unlike the situation with mutation and migration modifiers, the mean fitness here can increase as rates increase.

How can individuals estimate their fitness relative to the population mean fitness? 
In microbes, empirical evidence suggests that the mutation rate is negatively-correlated with population density~\citep{Krasovec2017} and is probably regulated by quorum sensing mechanisms~\citep{Krasovec2014,Dellus-Gur2017}.
Animals can assess the well-being of other individuals, for example via rival and mutual assessment~\citep{Parker1974,Arnott2017,Reichert2017}, and possibly integrate these assessments over a population sample.
Our results suggest that such assessments might affect the tendency of individuals to generate variation, e.g. explore new genetic backgrounds, environments, and behaviors.

Eq.~\ref{eq:mfp} is a generalization of a result of~\citet[Eq.~4]{Ram2012}.
\citeauthor{Ram2012} modeled the accumulation of mutant alleles in a population (see \nameref{sec:mut_model_2}).
Using Eq.~\ref{eq:Caswells_formula} in \nameref{sec:AppA} and a recursion on the ratios of the reproductive values \cite[see][eqs.~A5-6]{Ram2012}, they concluded that at the mutation-selection balance, if individuals with below-average fitness ($w_k < \hat{\bar w}$) increase their mutation rate, then the population mean fitness will increase -- a result generalized by our  \emph{modified mean-fitness principle} in Eqs.~\ref{eq:mfp_sign} and~\ref{eq:mfp_sign_threshold}.

Besides mutation, our principle applies to other variation-generating processes such as conditional dispersal and migration, and learning (see \emph{\nameref{sec:models}} section).
For example, the \emph{reduction principle} applies to ecological models of dispersal~\citep{Hastings1983, Hutson1995,Dockery1998,Cantrell2010,Altenberg2012a}, and~\citet{Gueijman2013} have demonstrated that even in homogeneous environments, fitness-associated dispersal increases the mean fitness of diploid populations and is favored by selection over uniform dispersal. These results parallel similar results found for reaction-diffusion models for the evolution of conditional dispersal in continuous time and space \cite{Chen2008,Hambrock2009,Cosner2009,Cantrell2010Ideal,Lam2014}.
Similarly, if the transmission fidelity of culturally-transmitted traits depends on the type or fitness of the transmitting individual, we expect that our results will hold (see \nameref{sec:learn_model}).

Our analysis focuses on populations at equilibrium.
Nevertheless, it has been demonstrated that during adaptive evolution (i.e., in non-equilibrium populations), a modifier that increases the mutation rate of maladapted individuals can be favored by selection~\citep{Ram2012,Lukacisinova2017} and increase the adaptation rate~\citep{Ram2014},
and empirical evidence suggests that \emph{stress-induced mutagenesis} is common in bacteria and yeast, and may be prevalent in plants, flies, and human cancer cells~\citep{Rosenberg2012,Fitzgerald2017b}.
Similar theoretical results have been demonstrated for a modifier that increases the recombination rate in maladapted individuals~\citep{Hadany2003b,Hadany2003a}.

% Conclusions
\paragraph*{Conclusions.}

Departures from the \emph{reduction principle} for mutation, recombination, and migration rates usually involve fluctuating selection,  non-equilibrium dynamics, or departures from random mating (see~\cite{Carja2014} and references therein).
Here we have provided another general example, which suggests that a modifier allele that causes individuals with below-average fitness to increase the rate at which variation is generated, will be favored by selection and will lead to increased population mean fitness.

\section*{Appendices}

% Appendix: Caswell formula
\subsection*{Appendix A}\label{sec:AppA}

\citet{Caswell1978} gave a \emph{formula for the sensitivity of the population growth rate to changes in life history parameters}.
In this formula, the \emph{population growth rate} is the leading eigenvalue of the population transformation matrix $T$, the \emph{life history parameters} are entries of $T$, and the \emph{sensitivity} is the derivative of the former with respect to the latter.
This is a useful formula~\citep[ch.~10]{Caswell1978,Hermisson2002,Ram2012,Otto2007}, and therefore we reproduce it here.

\begin{lemma}
$T$ be a non-negative matrix with leading eigenvalue $\lambda$ and left and right eigenvectors $\hat u$ and $\hat v$ such that $\sum{\hat v_k}=1$ and $\hat u\tr \hat v = \sum{\hat u_k \hat v_k} = 1$.
Then the sensitivity of $\lambda$ to changes in any element $t$ of the matrix $T$ is
\begin{equation}\label{eq:Caswells_formula}
\frac{\partial \lambda}{\partial t} = 
\hat u\tr \frac{\partial T}{\partial t} \hat v
\end{equation}
\end{lemma}

\begin{proof} 
Using the lemma assumptions,
$\lambda = \lambda \hat u\tr \hat v = \hat u\tr \lambda \hat v = \hat u\tr T \hat v$ and differentiating both sides we get $\partial \lambda = \partial (\hat \hat u\tr T \hat v)$.
Using the product rule (once in each direction),
\begin{equation}
\begin{aligned}
\partial (\hat u\tr T \hat v) = 
\partial \hat u\tr T \hat v + \hat u\tr \partial T \hat v + \hat u\tr T \partial \hat v = \\
\hat u\tr \partial T \hat v + \partial \hat u\tr \lambda \hat v  + \lambda \hat u\tr \partial \hat v = \\
\hat u\tr \partial T \hat v + \lambda(\partial \hat u\tr \hat v  + \hat u\tr \partial \hat v) = \\
\hat u\tr \partial T \hat v + \lambda \partial(\hat u\tr \hat v).
\end{aligned}
\end{equation}
Because $\hat u\tr \hat v = 1$,
we have $\partial (\hat u\tr \hat v) = 0$ and
$\partial \lambda = \hat u\tr \partial T \hat v$.
\end{proof}

% Appendix: Fisher's reproductive value
\subsection*{Appendix B}\label{sec:AppB}
\begin{remark}[Fisher's reproductive value]
Let $M$ be a primitive column-stochastic matrix and $D$ be a positive diagonal matrix. 
The entries of the left \emph{Perron} eigenvector $\hat u$ of the matrix $MD$ can be regarded as \emph{Fisher's reproductive values}~\citep[pg.~27]{Fisher1930}
\end{remark}

\emph{Fisher's reproductive values} can be understood as follows~\citep[ch.~10]{Grafen2006,Otto2007}.
Consider the dynamics not of frequencies but of absolute population sizes such that the vector of the number of individuals of each type at time $t$ is $n(t)$ and the corresponding frequencies are $f_k(t) = n_k(t) / \sum_i{n_i(t)}$.
The dynamics are
\begin{equation}
n(t) = (MD)^t n(0).
\end{equation}

Let $n(k, t)$ be the vector when the initial population is a single individual of type $k$.
The dynamics are
\begin{equation}
n(k,t) = (MD)^t e_k,
\end{equation}
where $e_k$ is a vector with 1 at position $k$ and 0 elsewhere.

The total population size at time $t$ starting with type $k$ is then
\begin{equation}
N(k,t) = \sum_i{n_i(k,t)} = e\tr (MD)^t e_k.
\end{equation}

Now we can compare the sizes of populations based on what type they started
with:
\begin{equation}
\frac{N(j,t)}{N(k,t)} = 
\frac{e\tr (MD)^t e_j}{e\tr (MD)^t e_k}.
\end{equation}

Now write $MD$ in its Jordan canonical form 
\begin{equation}
A = V \Lambda U\tr,
\end{equation}
where $V$ is the matrix of right (column) eigenvectors of $MD$,
$U\tr$ is the transposed matrix of left (row) eigenvectors of $MD$,
where we can take $V U\tr = U\tr V = I$, 
and $\Lambda$ is the diagonal matrix of eigenvalues of $A$ 
(for a non-generic set of matrices $M$, the geometric and algebraic multiplicities of the eigenvalues of $MD$ differ, and $\Lambda$ will not be a diagonal matrix, a case we can ignore).

Hence,
\begin{multline}
N(k, t) = 
e\tr (MD)^t e_k =
e\tr  (V \Lambda U\tr)^t e_k = \\
e\tr V \Lambda^t U\tr e_k.
\end{multline}

For the ratio, we can divide $\Lambda$ by $\lambda_1 = \rho(MD)$,
the spectral radius of $MD$:
\begin{multline}
\frac{N(j,t)}{N(k,t)} =
\frac{ e\tr V \Lambda^t U\tr e_j}{ e\tr V \Lambda^t U\tr e_k} = \\
\frac{ e\tr V \diag{1, \Big(\frac{\lambda_2}{\lambda_1}\Big)^t, \cdots} U\tr e_j} { e\tr V \diag{1,\Big(\frac{\lambda_2}{\lambda_1}\Big)^t, \cdots} U\tr e_k}.
\end{multline}
Now take the limit $t \goesto \infty$.
By assumption, $MD$ is primitive, so $\left|\lambda_i\right| < \lambda_1$ for all $i > 1$.
Therefore,
\begin{equation}
\lim_{t \goesto \infty} \Big( \frac{\lambda_k}{\lambda_1} \Big)^t = 0
\end{equation}
for all $k > 1$, and
\begin{equation}
\begin{aligned}
\lim_{t \goesto \infty}\frac{N(j,t)}{N(k,t)} = 
\frac{e\tr V (e_1 e_1\tr) U\tr e_j} { e\tr V (e_1 e_1\tr) U\tr e_k} = \\
\frac{ e\tr \hat v \hat u_j} { e\tr \hat v  \hat u_k} =
\frac{\hat u_j} {\hat u_k}.
\end{aligned}
\end{equation}

The vector $\hat u$ is the left \emph{Perron} eigenvector of $MD$, and $\hat u_k$ is $k$-th element of $\hat u$.
This is why the value $\hat u_k$ can be interpreted as the \emph{reproductive value} of type $k$: it is a weighting for the size of the population generated by a single individual of type $k$.

If we begin with a population at the equilibrium distribution $\hat v$,
and ask what fraction of long-term descendants descended from type $k$ at that time,
we weight the equilibrium frequency $\hat v_k$ by the reproductive value $\hat u_k$, to get $\hat u_k \hat v_k$.
$\{\hat u_k \hat v_k\}_{k}$ is a probability distribution, since
\begin{equation}
\sum_k {\hat u_k \hat v_k} = \hat u\tr \hat v = 1.
\end{equation}
\citet{Hermisson2002} called this distribution the \emph{ancestor} or \emph{ancestral distribution}.

% Appendix: inner stability
\subsection*{Appendix C}\label{sec:AppC}

\begin{lemma}[Stability of the equilibrium $\hat v$]
If $C$ and $D$ are positive diagonal matrices, $C\ne I$, and $M$ is irreducible, 
then the equilibrium $\hat v$ of the system in Eq.~\ref{eq:model_equilibrium} is globally stable.
\end{lemma}

\begin{proof}
Let $E=(I-C+MC)D$ and denote the spectral radius of $E$ as $\hat{\bar w}$. 

Since $D$ is a positive diagonal matrix, and by assumption $C_k < 1$ for at least one $k$, $E$ has at least one positive diagonal element, making it aperiodic.  Further more, since $D$ is a positive diagonal matrix and $M$ is irreducible, $E$ is also irreducible.  Hence $E$ is primitive.

According to the \emph{Perron-Frobenius theorem}, 
\begin{equation}
\bigg(\frac{E}{\hat{\bar w}}\bigg)^t \goesto \frac{\hat v \hat u\tr}{\hat u\tr \hat v} = \hat v \hat u\tr,
\end{equation}
where $\hat u$ and $\hat v$ are the left and right Perron eigenvectors of $A$ such that 
\begin{equation}
\sum_{k=1}^{n}{\hat v_k}=1, \quad
\hat u\tr \hat v=\sum_{k=1}^{n}{\hat u_k \hat v_k}=1,
\label{eq:sum_uv}
\end{equation}
and $\hat v \hat u\tr$ is the \emph{Perron projection} into the eigenspace corresponding to $\hat{\bar w}$.

Therefore, for any positive frequency vector $f$
\begin{equation}
\bigg(\frac{E}{\hat{\bar w}}\bigg)^t \cdot f \goesto \hat v \hat u\tr \cdot f = \alpha \hat v,
\label{eq:perron_projection}
\end{equation}
where $\alpha \in \mathbb{R}$.
Using eqs.~\ref{eq:sum_uv} and~\ref{eq:perron_projection}
\begin{equation}
\begin{aligned}
\alpha = \alpha \hat u\tr \hat v = 
\hat u\tr \alpha \hat v = 
\hat u\tr \hat v \hat u\tr f = \\
\hat u\tr f = 
\sum_{k=1}^{n}{\hat u_k f_k} > 0,
\label{eq:alpha0}
\end{aligned}
\end{equation}
because $f$ and $\hat u$ are positive vectors.

Now, let $\norm{x} = \sum_{k=1}^{n}\abs{x_k}$, so that $x_t \goesto x$ implies
\begin{equation}
\norm{x_t} \goesto \norm{x},
\label{eq:norm_limit}
\end{equation}
as $t \goesto \infty$ and rewrite Eq.~\ref{eq:model} as 
\begin{equation}
f' = \frac{E f}{\norm{E f}}. 
\label{eq:model_norm}
\end{equation}

It is easily seen that $f^t =E^tf/\|E^tf\|$. Hence 
\begin{multline}
\frac{E^t f}{\norm{E^t f}} = 
\frac{\frac{1}{(\hat{\bar w})^t} E^t f}{\frac{1}{(\hat{\bar w})^t} \norm{E^t f}} = 
\frac{\big(\frac{E}{\hat{\bar w}}\big)^t \cdot f }{ \norm{ \big(\frac{E}{\hat{\bar w}}\big)^t \cdot f }} \goesto \\
\frac{\alpha \hat v}{\norm{\alpha \hat v}} = \hat v,
\end{multline}
since $\norm{\hat v}=1$ (eq.~\ref{eq:sum_uv}) and $\alpha \ne 0$ (eq.~\ref{eq:alpha0}).
This completes the proof.
\end{proof}

% Acknowledgements
{\small
\section*{Acknowledgements}

This work was supported in part by 
the Department of Information and Computer Sciences at the University of Hawai`i at M{\=a}noa, 
the Konrad Lorenz Institute for Evolution and Cognition Research, 
the Mathematical Biosciences Institute through National Science Foundation Award \#DMS 0931642, 
the Stanford Center for Computational, Evolutionary and Human Genomics, 
and the Morrison Institute for Population and Resources Studies, Stanford University.
}

\bibliographystyle{agsm}
%\bibliography{/Users/yoavram/Documents/library}
\bibliography{ms+Lee2}

\end{document}  